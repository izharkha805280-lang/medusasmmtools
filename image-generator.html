<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Generator - MedusaSMM</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@600&family=Inter:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* Shared CSS */
        :root { --bg: #030014; --glass: rgba(255,255,255,0.05); --border: rgba(255,255,255,0.1); --primary: #d900ff; --text: #fff; --gray: #9ca3af; --danger: #ff4444; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; display: flex; flex-direction: column; min-height: 100vh; margin: 0; }
        
        nav { padding: 20px 5%; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-family: 'Outfit', sans-serif; font-size: 1.5rem; text-decoration: none; color: #fff; }
        
        .main-wrapper { flex: 1; padding: 40px 20px; width: 100%; max-width: 800px; margin: 0 auto; }
        .tool-box { background: var(--glass); border: 1px solid var(--border); border-radius: 20px; padding: 30px; margin-bottom: 40px; text-align: center; }
        h1 { font-family: 'Outfit'; color: var(--primary); margin-bottom: 20px; font-size: 2rem; }
        
        input { width: 100%; padding: 18px; background: rgba(0,0,0,0.3); border: 1px solid #444; color: #fff; border-radius: 8px; font-size: 1rem; margin-bottom: 15px; outline:none; }
        input:focus { border-color: var(--primary); }

        button { width: 100%; padding: 18px; background: var(--primary); color: #fff; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1rem; transition: 0.3s; }
        button:hover { box-shadow: 0 0 20px var(--primary); transform: translateY(-2px); }
        button:disabled { background: #555; cursor: not-allowed; transform: none; box-shadow: none; }
        
        .image-container { 
            margin-top: 30px; 
            min-height: 300px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            background: rgba(0,0,0,0.2); 
            border-radius: 10px; 
            border: 1px dashed var(--gray);
            position: relative;
            overflow: hidden;
        }
        
        .image-container img { max-width: 100%; border-radius: 10px; display: none; box-shadow: 0 0 30px rgba(217, 0, 255, 0.3); }
        
        /* Loading Animation */
        .loading { display: none; color: var(--primary); font-family: 'Outfit'; font-size: 1.2rem; flex-direction: column; align-items: center; gap: 10px; }
        .spinner { width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .download-btn { display: inline-block; margin-top: 20px; padding: 12px 25px; background: #fff; color: #000; text-decoration: none; font-weight: bold; border-radius: 5px; display: none; cursor: pointer; }

        /* Error & Warning Box */
        .status-msg { margin-top: 15px; padding: 10px; border-radius: 8px; display: none; font-weight: bold; }
        .error { background: rgba(255, 68, 68, 0.2); color: #ff4444; border: 1px solid #ff4444; }
        .warning { background: rgba(255, 187, 0, 0.2); color: #ffbb00; border: 1px solid #ffbb00; }

        /* Content & Footer */
        .content-section { margin-top: 40px; color: var(--gray); line-height: 1.6; text-align: left; }
        .content-section h2 { color: #fff; font-family: 'Outfit'; margin-bottom: 15px; }
        .suggestions { margin-top: 50px; border-top: 1px solid var(--border); padding-top: 30px; }
        .sugg-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 20px; }
        .sugg-card { background: var(--glass); padding: 15px; border-radius: 10px; text-align: center; border: 1px solid var(--border); transition:0.3s; }
        .sugg-card:hover { border-color: var(--primary); transform: translateY(-3px); }
        .sugg-card a { text-decoration: none; color: #fff; display: block; }
        
        footer { border-top: 1px solid var(--border); padding: 40px 5%; background: rgba(0,0,0,0.3); margin-top: auto; }
        .copy { text-align: center; margin-top: 40px; color: var(--gray); font-size: 0.8rem; border-top: 1px solid var(--border); padding-top: 20px; }
    </style>
</head>
<body>
    <nav>
        <a href="index.html" class="logo">MedusaTools</a>
        <a href="index.html" style="color:#aaa; text-decoration:none;">Back</a>
    </nav>

    <div class="main-wrapper">
        <div class="tool-box">
            <h1>üé® AI Image Generator</h1>
            <p style="color:gray; margin-bottom:20px;">Safe & Secure AI Art Generation.</p>
            
            <input type="text" id="promptInput" placeholder="e.g. A futuristic cyberpunk city...">
            <button id="genBtn" onclick="generateImage()">‚ú® Generate Art</button>
            
            <div id="statusBox" class="status-msg"></div>

            <div class="image-container">
                <div class="loading" id="loader">
                    <div class="spinner"></div>
                    <span>Creating Magic... Please wait...</span>
                </div>
                <img id="resultImg" src="" alt="AI Generated Image">
            </div>

            <a id="downloadLink" class="download-btn" download="medusa-art.jpg">Download Image</a>
        </div>

        <div class="content-section">
            <h2>Safety Guidelines</h2>
            <p>To ensure a safe environment for everyone, we have a strict policy against inappropriate content.</p>
            <h3>Rules:</h3>
            <ul>
                <li>Do not generate NSFW, violent, or hateful content.</li>
                <li><strong>3 Strike Policy:</strong> If you use banned words 3 times, you will be suspended for 3 hours.</li>
            </ul>
        </div>

        <div class="suggestions">
            <h2>üî• Try These Tools</h2>
            <div class="sugg-grid">
                <div class="sugg-card"><a href="image-compressor.html">üìâ Image Compressor</a></div>
                <div class="sugg-card"><a href="text-speech.html">üó£Ô∏è Text to Speech</a></div>
                <div class="sugg-card"><a href="qr-generator.html">üî≥ QR Generator</a></div>
            </div>
        </div>
    </div>

    <footer>
        <div class="copy">&copy; 2024 MedusaSMM Tools. All rights reserved.</div>
    </footer>

    <script>
        // --- SAFETY CONFIGURATION ---
        // Aap yahan aur words add kar sakte hain
        const bannedWords = ['nude', 'boob'‚Äö 'pussy'‚Äö 'naked', 'sex', 'porn', 'xxx', 'blood', 'kill', 'murder', 'terrorist', 'drug', 'abuse', 'child'];
        const MAX_STRIKES = 3;
        const BAN_DURATION_MS = 3 * 60 * 60 * 1000; // 3 Hours in milliseconds

        function checkSafety(prompt) {
            let strikes = parseInt(localStorage.getItem('medusa_strikes') || '0');
            let banTime = parseInt(localStorage.getItem('medusa_ban_time') || '0');
            let currentTime = new Date().getTime();

            // 1. Check if User is Banned
            if (currentTime < banTime) {
                let remaining = Math.ceil((banTime - currentTime) / (1000 * 60)); // Minutes left
                showStatus(`‚õî You are suspended! Try again in ${remaining} minutes.`, 'error');
                return false;
            } else if (banTime > 0 && currentTime > banTime) {
                // Ban expired, reset
                localStorage.setItem('medusa_strikes', '0');
                localStorage.setItem('medusa_ban_time', '0');
                strikes = 0;
            }

            // 2. Check for Bad Words
            let lowerPrompt = prompt.toLowerCase();
            let foundBadWord = bannedWords.some(word => lowerPrompt.includes(word));

            if (foundBadWord) {
                strikes++;
                localStorage.setItem('medusa_strikes', strikes);

                if (strikes >= MAX_STRIKES) {
                    // Ban the user
                    let newBanTime = currentTime + BAN_DURATION_MS;
                    localStorage.setItem('medusa_ban_time', newBanTime);
                    showStatus(`üö´ Account Suspended for 3 Hours due to repeated policy violations.`, 'error');
                } else {
                    // Give Warning
                    let left = MAX_STRIKES - strikes;
                    showStatus(`‚ö†Ô∏è Warning! Inappropriate content detected. ${left} attempts remaining before suspension.`, 'warning');
                }
                return false;
            }

            // Safe to proceed
            hideStatus();
            return true;
        }

        function showStatus(msg, type) {
            const box = document.getElementById('statusBox');
            box.innerText = msg;
            box.className = `status-msg ${type}`; // Apply 'error' or 'warning' class
            box.style.display = 'block';
        }

        function hideStatus() {
            document.getElementById('statusBox').style.display = 'none';
        }

        // --- IMAGE GENERATION LOGIC ---
        async function generateImage() {
            let prompt = document.getElementById('promptInput').value;
            let imgElement = document.getElementById('resultImg');
            let loader = document.getElementById('loader');
            let downloadBtn = document.getElementById('downloadLink');
            let genBtn = document.getElementById('genBtn');

            if(!prompt) {
                alert("Please write a description first!");
                return;
            }

            // ** SAFETY CHECK RUN KAREIN **
            if (!checkSafety(prompt)) {
                return; // Stop function if unsafe or banned
            }

            // UI State: Loading
            imgElement.style.display = 'none';
            downloadBtn.style.display = 'none';
            loader.style.display = 'flex';
            genBtn.disabled = true;
            genBtn.innerText = "Generating...";

            let randomSeed = Math.floor(Math.random() * 10000);
            let apiUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?n=${randomSeed}&width=800&height=800&model=flux`;

            try {
                const response = await fetch(apiUrl);
                const blob = await response.blob();
                const imageBitmap = await createImageBitmap(blob);
                
                let canvas = document.createElement('canvas');
                let ctx = canvas.getContext('2d');
                canvas.width = imageBitmap.width;
                canvas.height = imageBitmap.height;

                ctx.drawImage(imageBitmap, 0, 0);

                // Watermark Logic
                let text = "MedusaSMM Tools";
                let fontSize = canvas.width / 25; 
                let padding = 20;

                ctx.font = `bold ${fontSize}px sans-serif`;
                let textWidth = ctx.measureText(text).width;
                
                let boxX = canvas.width - textWidth - (padding * 2);
                let boxY = canvas.height - fontSize - (padding * 1.5);
                let boxWidth = textWidth + (padding * 2);
                let boxHeight = fontSize + (padding * 2);

                ctx.fillStyle = "rgba(0, 0, 0, 0.7)"; 
                ctx.fillRect(boxX, boxY, boxWidth, boxHeight);

                ctx.fillStyle = "#ffffff";
                ctx.textAlign = "left";
                ctx.textBaseline = "middle";
                let textX = boxX + padding;
                let textY = boxY + (boxHeight / 2) + 4;
                ctx.fillText(text, textX, textY);

                let watermarkedUrl = canvas.toDataURL("image/jpeg");
                imgElement.src = watermarkedUrl;
                
                imgElement.onload = function() {
                    loader.style.display = 'none';
                    imgElement.style.display = 'block';
                    downloadBtn.href = watermarkedUrl;
                    downloadBtn.style.display = 'inline-block';
                    genBtn.disabled = false;
                    genBtn.innerText = "‚ú® Generate Art";
                };

            } catch (error) {
                console.error(error);
                showStatus("Error generating image. Server might be busy.", "error");
                loader.style.display = 'none';
                genBtn.disabled = false;
                genBtn.innerText = "‚ú® Generate Art";
            }
        }
    </script>
</body>
</html>
